fix: 代码审查问题修复 - 安全性、性能和代码质量提升

本次提交修复了代码审查中发现的所有 P0、P1 和 P2 级别问题，共计 12 个问题。

## 🔴 严重问题修复 (P0 - 4个)

### 安全性
- **路径遍历防护**: 改进图片访问端点的路径验证，只使用文件名并添加格式验证
- **异常信息泄露**: 根据日志级别决定是否返回详细错误信息，避免泄露敏感信息

### 性能
- **API Key 验证优化**: 从 `request.app.state` 获取 settings，使用 set 进行 O(1) 查找
- **临时文件清理**: 使用 `shutil.rmtree()` 确保完全清理临时目录

## 🟡 重要问题修复 (P1 - 5个)

### 资源管理
- **NVML 初始化优化**: 使用全局状态管理，避免重复初始化/关闭
- **文件上传原子写入**: 使用临时文件 + 原子替换，确保文件完整性

### 并发安全
- **队列竞态条件修复**: 队列满时回滚已添加的 job，避免内存泄漏
- **RateLimiter 后台清理**: 添加后台线程定期清理过期 bucket，减少主线程开销

### 性能优化
- **Token 管理 I/O 优化**: 使用后台线程批量写入，减少高并发下的文件 I/O 瓶颈
- **JSON 写入效率优化**: 写入前检查内容是否相同，避免不必要的磁盘操作

## 🟢 代码质量改进 (P2 - 3个)

- **魔法数字提取**: 提取硬编码数值为常量（DPI、图像质量等）
- **配置验证增强**: 添加 5 个配置验证器，防止不合理的配置值
- **日志级别优化**: 根据响应状态码选择适当的日志级别

## 📊 修复统计

- 严重问题 (P0): 4 个 ✅
- 重要问题 (P1): 5 个 ✅
- 代码质量 (P2): 3 个 ✅
- 总计: 12 个问题全部修复 ✅

## 🎯 修复效果

1. **安全性提升**: 路径遍历防护更严格，异常信息不再泄露
2. **性能优化**: API Key 验证、NVML 初始化、Token I/O、RateLimiter、JSON 写入均有优化
3. **稳定性提升**: 文件上传原子写入，队列竞态条件修复，临时文件清理改进
4. **代码质量**: 日志级别优化，重复代码清理，魔法数字提取，配置验证增强

## 📝 影响范围

- `app/api/v1/tasks.py`: 路径遍历防护、文件上传原子写入
- `app/security/auth.py`: API Key 验证性能优化
- `app/security/rate_limit.py`: 后台清理优化
- `app/security/tokens.py`: 异步 I/O 优化
- `app/utils/gpu.py`: NVML 全局状态管理
- `app/services/queue.py`: 队列竞态条件修复
- `app/services/dsocr_model.py`: 临时文件清理、魔法数字提取
- `app/storage/local.py`: JSON 写入效率优化
- `app/config.py`: 配置验证增强
- `app/middleware.py`: 日志级别优化
- `app/api/v1/infer.py`: 异常信息泄露修复、魔法数字提取

## 🔗 相关文档

- 详细修复说明: `docs/FIXES_SUMMARY.md`
- 代码审查报告: `docs/CODE_REVIEW.md`

