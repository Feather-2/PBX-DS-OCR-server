# Example environment variables for docker-compose
# API keys
# 推荐：单键使用 APP_API_KEY，避免 APP_API_KEYS 在部分解析器中被误判为 JSON 而报错
# 多键可以用逗号分隔：APP_API_KEYS=sk_a,sk_b
APP_API_KEYS=sk_example
# APP_API_KEY=sk_example
APP_BACKEND=hf
APP_METRICS_ENABLED=true
APP_REQUIRE_AUTH=true
APP_MAX_WORKERS=1
APP_MAX_QUEUE_SIZE=100
APP_MAX_UPLOAD_MB=200
APP_MAX_PAGES=500
APP_FORCE_CPU=false
APP_DS_MODEL_PATH=deepseek-ai/DeepSeek-OCR
APP_DS_DTYPE=bfloat16
APP_DS_USE_FLASH_ATTN=true
APP_DS_BASE_SIZE=1024
APP_DS_IMAGE_SIZE=640
APP_DS_CROP_MODE=true
APP_STORAGE_ROOT=/srv/app/data/jobs
APP_ENABLE_DS_MODEL=true
APP_ENABLE_MCP=false
APP_RATE_LIMIT_ENABLED=true
APP_RATE_LIMIT_RPS=10
APP_RATE_LIMIT_BURST=20
APP_RATE_LIMIT_EXEMPT=/healthz,/metrics
APP_LOGIN_RATE_PER_MIN=10
APP_LOGIN_RATE_BURST=10
APP_CONSOLE_ENABLED=true
# APP_CONSOLE_PASSWORD=your_password
APP_CONSOLE_SESSION_MAX_AGE=86400
APP_COOKIE_SECURE=false

# CORS
# 推荐在生产环境显式设置为具体域名，多个用逗号分隔；
# 如需允许任意来源请设为 '*'，此时将自动关闭凭据支持（Access-Control-Allow-Credentials=false）。
# 例如：APP_CORS_ALLOW_ORIGINS=https://your-frontend.example.com,https://other.example.com
APP_CORS_ALLOW_ORIGINS=*
# 当允许跨域携带 Cookie/凭据时，必须使用具体 Origin，不能是 '*'
APP_CORS_ALLOW_CREDENTIALS=true
# 可选：使用正则形式动态匹配来源（与上面列表二选一使用）
# APP_CORS_ALLOW_ORIGIN_REGEX=^https://.*\.example\.com$

# GPU & HF backend (recommended defaults for stability)
# Use GPU if available and auto-select dtype (bf16 on CUDA, fp32 on CPU)
APP_FORCE_CPU=false
APP_GPU_INDEX=0
APP_DS_DTYPE=auto
# Prefer disabling FlashAttention for broad compatibility; enable only if you are sure
APP_DS_USE_FLASH_ATTN=false

# Dynamic concurrency gating by free VRAM (good defaults for 24GB GPUs)
APP_DYNAMIC_WORKERS=true
APP_MAX_WORKERS=2
APP_MEM_PER_JOB_GB=10.0
APP_RESERVE_GPU_MEM_GB=2.0
APP_IDLE_UNLOAD_SECONDS=600

# Hugging Face cache (speed up first run and reuse weights)
HF_HOME=/srv/app/data/hf-cache
TRANSFORMERS_CACHE=/srv/app/data/hf-cache

# vLLM overlay 镜像说明（Dockerfile.vllm.overlay）
# - 复用已发布的 vLLM 基础镜像；不修改 transformers/tokenizers 版本，仅增加 DS‑OCR 远程代码依赖。
# - 快速健康检查：APP_ENABLE_DS_MODEL=false 可跳过模型加载。
# - 开启 GPU：需要主机装好 NVIDIA 驱动与 Container Toolkit，运行容器时添加 --gpus all。
